<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>HappyFunTimes Class: AppleCaptivePortalHandler</title>

	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">HappyFunTimes</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="AppleCaptivePortalHandler.html">AppleCaptivePortalHandler</a>
						</li>
						
						<li>
							<a href="Game.html">Game</a>
						</li>
						
						<li>
							<a href="HFTGame.html">HFTGame</a>
						</li>
						
						<li>
							<a href="LoopbackServerSide.html">LoopbackServerSide</a>
						</li>
						
						<li>
							<a href="Player.html">Player</a>
						</li>
						
						<li>
							<a href="RelayServer.html">RelayServer</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#close">close</a>
						</li>
						
						<li>
							<a href="global.html#ES6Support">ES6Support</a>
						</li>
						
						<li>
							<a href="global.html#GameGroup">GameGroup</a>
						</li>
						
						<li>
							<a href="global.html#HFTServer">HFTServer</a>
						</li>
						
						<li>
							<a href="global.html#LocalWebSocketServer">LocalWebSocketServer</a>
						</li>
						
						<li>
							<a href="global.html#setup">setup</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
		<div class="span8">
			
				<div id="main">
					


	<h1 class="page-title">Class: AppleCaptivePortalHandler</h1>
<section>

<header>
    <h2>
    AppleCaptivePortalHandler
    </h2>
    
</header>

<article>
    <div class="container-overview">
    

    
        
<dt>
    <h4 class="name" id="AppleCaptivePortalHandler"><span class="type-signature">&lt;private> </span>new AppleCaptivePortalHandler<span class="signature">(options)</span><span class="type-signature"></span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Object to try to encapulate dealing with Apple's captive
portal detector.</p>
<p>Note: I'm sure there's a better way to do this but ... my
guess is most captive portal handling is done at a lower
level where the system tracking who can access the network
and who can't does so by tracking MAC addresses. A router can
do that but at the TCP/IP level of an app like this the MAC
address of a particular connection is not available AFAIK.</p>
<p>So, we do random things like session ids. For the purpose of
HappyFunTimes our only goal is to connect the player to the
games through Apple's captive portal detector.</p>
<p>By snooping the network it appears Apple's portal detector
will always set the <code>user-agent</code> and use some semi-random
looking UUID as the path. If we see that user agent then we
make up a sessionid from the path. The flow is something like
this</p>
<ol>
<li>Recognize Apple's Captive Portal Detector (user-agent)</li>
<li>Use UUID like path as sessionId</li>
<li>Send /captive-portal.html with sessionid embeded in url
to game-login.html and JS redirect to that url.</li>
<li>when we serve game-login.html we recognize the session
id and mark that session id as &quot;loggedIn&quot;</li>
<li>Apple's captive portal detector will try again with the
same session id, this time we'll return the response it
expects. Apple's captive protal detector will think
the system can access the net. It will change it's UI
from &quot;Cancel&quot; to &quot;Done&quot; and any links displayed when
clicked will launch Safari (or the user's default
browser on OSX).</li>
</ol>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">AppleCaptivePortalHandler~Options</span>

            
            </td>

            

            

            <td class="description last"><p>options</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        <dl>
            
<dt>
    <h4 class="name" id="check"><span class="type-signature"></span>check<span class="signature">(req, res)</span><span class="type-signature"> &rarr; {boolean}</span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Check if this request has something to do with captive portal
handling and if so handle it.</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">Request</span>

            
            </td>

            

            

            <td class="description last"><p>node request object</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>res</code></td>
            

            <td class="type">
            
                
<span class="param-type">Response</span>

            
            </td>

            

            

            <td class="description last"><p>node response object</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    <h5>Returns:</h5>
    
            
<div class="param-desc">
    <p>true if handled, false if not.</p>
</div>



<dl>
	<dt>
		Type
	</dt>
	<dd>
		
<span class="param-type">boolean</span>

	</dd>
</dl>


        
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="sendCaptivePortalHTML"><span class="type-signature"></span>sendCaptivePortalHTML<span class="signature">(req, res, sessionId, opt_path)</span><span class="type-signature"></span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Sends captive-portal.html (or optionally a different html
file) but does substitutions</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">Request</span>

            
            </td>

            

            

            <td class="description last"><p>node's request object.</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>res</code></td>
            

            <td class="type">
            
                
<span class="param-type">Response</span>

            
            </td>

            

            

            <td class="description last"><p>node's response object.</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>sessionId</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>

            
            </td>

            

            

            <td class="description last"><p>some sessionid</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>opt_path</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>

            
            </td>

            

            

            <td class="description last"><p>base path relative path of html file</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="setFirstPath"><span class="type-signature"></span>setFirstPath<span class="signature">(path)</span><span class="type-signature"></span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Sets the path we go to after the user picks <code>[Start]</code></p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>path</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>

            
            </td>

            

            

            <td class="description last"><p>path to go to . Default is
       &quot;/enter-name.html&quot;</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        
            
<dt>
    <h4 class="name" id="setOptions"><span class="type-signature"></span>setOptions<span class="signature">(options)</span><span class="type-signature"></span></h4>
    
    
</dt>
<dd>
    
    
    <div class="description">
        <p>Sets options</p>
    </div>
    

    
    
    
    
    
        <h5>Parameters:</h5>
        

<table class="params table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">AppleCaptivePortalHandler~Options</span>

            
            </td>

            

            

            <td class="description last"><p>options</p></td>
        </tr>

	
	</tbody>
</table>

    
    
    
<dl class="details">
	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>

    
    

    

    
    
    
    
    
    
    
</dd>

        </dl>
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        <dl>
                
<dt class="name" id="Optons">
    <h4>Optons</h4>

    
</dt>
<dd>
    

    
        <h5>Type:</h5>
        <ul>
            <li>
                
<span class="param-type">Object</span>

            </li>
        </ul>
    

    
<dl class="details">
	

	<h5 class="subsection-title">Properties:</h5>

	<dl>

<table class="props table table-striped">
    <thead>
	<tr>
		
		<th>Name</th>
		

		<th>Type</th>

		

		

		<th class="last">Description</th>
	</tr>
	</thead>

	<tbody>
	

        <tr>
            
                <td class="name"><code>sendFileFn</code></td>
            

            <td class="type">
            
                
<span class="param-type">SendFile~Callback</span>

            
            </td>

            

            

            <td class="description last"></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>address</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>

            
            </td>

            

            

            <td class="description last"><p>address to make urls from. eg,
          192.1.2.3</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>port</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>

            
            </td>

            

            

            <td class="description last"><p>port for urls eg. 8080</p></td>
        </tr>

	

        <tr>
            
                <td class="name"><code>baseDir</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>

            
            </td>

            

            

            <td class="description last"><p>path to portal files</p></td>
        </tr>

	
	</tbody>
</table>
</dl>

	

	

	

	

	

	

	

	

	



	

	

	

	
</dl>


    
</dd>

            </dl>
    

    
</article>

</section>




				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		copyright Gregg Tavares
		</span>
					<br />
					
				</footer>
			</div>

			
			<div class="span3">
				<div id="toc"></div>
			</div>
			
			<br clear="both">
		</div>

	</div>
	<script src="scripts/prettify/prettify.js"></script>
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$(".dropdown-menu a").each(function() {
				var text = $(this).text();
				$(this).text(text.replace(/\//g, '.'));
			});

			$( "#toc" ).toc( {
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "prettyprint" )
						.html( example.html() );

				}
			} );

			$('pre>code')
			   .unwrap()
			   .replaceWith(function() {
				 return $('<pre class="prettyprint showlinemods">' + this.innerHTML + '</pre>')
			   });
			prettyPrint();

		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	
	<script>
		(function ( i, s, o, g, r, a, m ) {
			i['GoogleAnalyticsObject'] = r;
			i[r] = i[r] || function () {
				(i[r].q = i[r].q || []).push( arguments )
			}, i[r].l = 1 * new Date();
			a = s.createElement( o ),
				m = s.getElementsByTagName( o )[0];
			a.async = 1;
			a.src = g;
			m.parentNode.insertBefore( a, m )
		})( window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga' );

		ga( 'create', 'UA-51764205-4', 'auto' );
		ga( 'send', 'pageview' );
	</script>
	

</body>
</html>
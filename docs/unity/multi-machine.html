<!DOCTYPE html>
<!-- this file is auto-generated from docs/unity/multi-machine.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

    * Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.
    * Redistributions in binary form must reproduce the above
copyright notice, this list of conditions and the following disclaimer
in the documentation and/or other materials provided with the
distribution.
    * Neither the name of Gregg Tavares. nor the names of his
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0, user-scalable=yes">
<meta property="og:title" content="Multiple Computers" />
<meta property="og:type" content="website" />
<meta property="og:image" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg" />
<meta property="og:description" content="How to make a game that runs across mutliple computers." />
<meta property="og:url" content="http://docs.happyfuntimes.net/docs/unity/multi-machine.html" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@greggman" />
<meta name="twitter:creator" content="@greggman" />
<meta name="twitter:domain" content="docs.happyfuntimes.net" />
<meta name="twitter:title" content="Multiple Computers" />
<meta name="twitter:url" content="http://docs.happyfuntimes.net/docs/unity/multi-machine.html" />
<meta name="twitter:description" content="How to make a game that runs across mutliple computers." />
<meta name="twitter:image:src" content="http://docs.happyfuntimes.net/docs/images/happyfuntimes.jpg" />

<title>Multiple Computers</title>
<link href="/public/hft-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/docs/css/base.css" type="text/css" />
<link rel="stylesheet" href="/docs/css/lesson.css" type="text/css" />
</head>
<body>
<div class="header">
  <h1><a href="/docs/unity">HappyFunTimes Docs</a></h1>
</div>


<div class="container">
  <div class="lesson-title">
    <h1>Multiple Computers</h1>
  </div>
  <div class="row">
    <div class="col-sm-8 lesson-main">
      <p>First off you might be interested in this video to see what running across multiple computers means</p>
<iframe width="853" height="480" src="https://www.youtube.com/embed/aFMNmKYE8KM?rel=0" frameborder="0" allowfullscreen></iframe>

<p>The game above spans 6 monitors. Each monitor has its own computer. Players can jump from monitor
to monitor and walk up and down a large level.</p>
<p>For Unity3D you might want to <a href="http://docs.happyfuntimes.net/docs/unity/samples.html?owner=greggman&amp;repo=hft-unity-multi-game-example">download this sample</a>
into an new scene in Unity.</p>
<p>You can run this sample solo in the Unity Editor but to run multiple copies it
 <strong>MUST BE RUN FROM THE COMMAND LINE</strong>. The reason is each instance needs an ID and so
running by clicking an app or from an editor would require editing that id. To run from the command
line you must EXPORT an executable.  With Unity closed, open a Terminal/Command Prompt, cd to the
folder your unity project is in and type <code>hft export</code> to automatically export</p>
<p>On OSX these command lines would launch 3 windows in the local machine</p>
<pre><code>bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-osx --hft-id=game0 --num-games=3
bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-osx --hft-id=game1 --num-games=3
bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-osx --hft-id=game2 --num-games=3
</code></pre><p>On windows</p>
<pre><code>bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-win.exe --hft-id=game0 --num-games=3
bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-win.exe --hft-id=game1 --num-games=3
bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-win.exe --hft-id=game2 --num-games=3
</code></pre><p>If you run those commands and then open a browser window to <a href="http://localhost:18679">http://localhost:18679</a> a player should
appear. Jumping off the left / right edges of a window should make you go to the next window.</p>
<p>If you were running on multiple machines the 3 machines might use lines like this</p>
<ul>
<li><p>machine 1</p>
<pre><code>bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-osx --hft-id=game0 --num-games=3 --hft-url=ws://192.168.1.9:18679 --hft-master
</code></pre></li>
<li><p>machine 2</p>
<pre><code>bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-osx --hft-id=game1 --num-games=3 --hft-url=ws://192.168.1.9:18679
</code></pre></li>
<li><p>machine 3</p>
<pre><code>bin/unitymultigame-osx.app/Contents/MacOS/unitymultigame-osx --hft-id=game2 --num-games=3 --hft-url=ws://192.168.1.9:18679
</code></pre></li>
</ul>
<p>where <code>192.68.1.9</code> is the IP address of the machine running HappyFunTimes.</p>
<p>All machines must have the game in the same path AND whatever machine is running HappyFunTimes also needs a copy
of the game at the exact same PATH as these machines.</p>
<p>This particular game just runs a simple level and when you jump off the right side of the screen
it transfers that player to the next game. In other words, if you are on <code>game1</code> and you go off the
right side of the screen you&#39;ll be sent to <code>game2</code>. Conversely if you jump off the
left side you&#39;d be send to <code>game0</code>. <code>--num-games</code> determines when to wrap around so in the above example
with <code>--num-games=3</code> if you&#39;re on <code>game2</code> and go off the right you&#39;ll be sent to <code>game0</code>.</p>
<p>Of course in your own game you could put up a dialog box or something and ask for an ID but
most people running multiple machine games are probably doing so in a setting they want to
automate and so using the command line seems like the best way.</p>
<h2 id="how-it-works">How it works</h2>
<p>Each computer runs 100% independently with no knowledge that any other games are running.
To each computer it just looks like a normal HappyFunTimes game. Players connect just like
normal.</p>
<p>The difference is, based on whatever logic YOU DECIDE, your game can tell HappyFunTimes to
transfer a player to another machine. It does this by calling <code>NetPlayer.SwitchGame</code>,
specifying the id of the game to send the player to, and passing any data you want with that player.
That player will then be disconnected from this computer and connected to the computer with the specified
id.</p>
<p>When the player connects to the new machine the <code>InitializeNetPlayer</code> method will be called just like
normal except the data the previous machine sent is passed as well. It&#39;s up to you to decide what
data to pass.</p>
<h2 id="passing-data-from-one-game-to-another">Passing Data from one Game to Another</h2>
<p>Looking at the <code>BirdScript.cs</code> code the sample above. First we create a mesasge with the
data we want to send between games.</p>
<pre><code>// Message to send when sending a player to another game
private class MessageSwitchGame : MessageCmdData
{
    public Vector2 pos;  // where the player was
    public Vector2 vel;  // what speed he was going
    public string name;  // his name
    public Color color;  // his color
    public float dir;    // what direction he&#39;s facing
}
</code></pre><p>Then we make some code to send a player to another game</p>
<pre><code>void SwitchGame(int dir)
{
    MessageSwitchGame data = new MessageSwitchGame();
    data.pos = transform.position;
    data.vel = m_rigidbody2d.velocity;
    data.name = m_playerName;
    data.color = m_color;
    data.dir = m_direction;

    // Look up the id of the game where in. Something like &quot;level3&quot;
    string gameId = LevelSettings.settings.playerSpawner.server.Id;

    // Extract the number part
    int numNdx = gameId.IndexOfAny(&quot;0123456789&quot;.ToCharArray());
    int gameNum = System.Convert.ToInt32(gameId.Substring(numNdx));

    // Increment or Decrement the number wraping at the ends
    gameNum = (gameNum + LevelSettings.settings.numGames + dir) % LevelSettings.settings.numGames;

    // Build the ID of the game we want to switch to
    gameId = gameId.Substring(0, numNdx) + gameNum;

    // Send this player to that game.
    // Note: No more messages will be received or sent to this player.
    m_netPlayer.SwitchGame(gameId, data);
}
</code></pre><p>IMPORTANT! You can see the logic here for how to switch game is in YOUR CODE. You make up the
rules. The code above looks at <code>dir</code> passed into the function which is either +1 if we want
to send to the next game id or -1 if want to send the the previous game id.</p>
<p>It then assumes the id of the current game is something that ends with numbers as in &quot;blabla123&quot;.
It pulls out the number part, adds or subtracts one, mods it (the %) so that it wraps around
based on <code>numGames</code>.  In other words if <code>dir = 1</code> and <code>gameId = foo3</code> and <code>numGames = 4</code> then
the result will be <code>foo0</code> since <em>it assumes</em> the games are named <code>foo0</code>, <code>foo1</code>, <code>foo2</code>, <code>foo3</code>.</p>
<p>Finally it calls <code>m_netPlayer.SwitchGame(gameId, data)</code> which will immediately disconnect the
player from this game and send him to the game of the specified id.</p>
<p>The code calls <code>SwitchGame(-1)</code> when the player goes off the left side of the level and <code>SwitchGame(1)</code>
when the player goes of the right side of the level</p>
<pre><code>...
if (transform.position.x &lt; LevelSettings.settings.leftEdgeOfLevel.position.x) {
    SwitchGame(-1);
} else if (transform.position.x &gt; LevelSettings.settings.rightEdgeOfLevel.position.x) {
    SwitchGame(1);
}
...
</code></pre><p>The game receiving the player will have it&#39;s <code>InitializeNetPlayer</code> method called. Again looking
at <code>BirdScript.cs</code></p>
<pre><code>// Called when player connects with their phone
void InitializeNetPlayer(SpawnInfo spawnInfo)
{
    Init();

    m_netPlayer = spawnInfo.netPlayer;
    m_netPlayer.OnDisconnect += Remove;
    m_netPlayer.OnNameChange += ChangeName;

    // Setup events for the different messages.
    m_netPlayer.RegisterCmdHandler&lt;MessageMove&gt;(&quot;move&quot;, OnMove);
    m_netPlayer.RegisterCmdHandler&lt;MessageJump&gt;(&quot;jump&quot;, OnJump);

    // We always get a `data` so check if it has one key from our expected message
    if (spawnInfo.data != null &amp;&amp; spawnInfo.data.ContainsKey(&quot;dir&quot;)) {
        // This player was transferred from another game.

        // Turn the data back into our structure
        DeJson.Deserializer deserializer = new DeJson.Deserializer();
        MessageSwitchGame data = deserializer.Deserialize&lt;MessageSwitchGame&gt;(spawnInfo.data);

        // Choose a starting position based on the old position
        float x = (data.pos.x &lt; LevelSettings.settings.leftEdgeOfLevel.position.x)
            ? LevelSettings.settings.rightEdgeOfLevel.position.x - 1 :
              LevelSettings.settings.leftEdgeOfLevel.position.x + 1;
        transform.localPosition = new Vector3(x, data.pos.y, 0f);

        // Set the initial velocity
        m_rigidbody2d.velocity = data.vel;

        // And the direction
        m_direction = data.dir;

        SetName(data.name);
        SetColor(data.color);
    } else {
        // This player just joined.
        MoveToRandomSpawnPoint();
        SetName(m_netPlayer.Name);
    }
}
</code></pre><p>We can see it checks if this is a brand new player or one transfered from another machine.
It does this by checking for one of the fields of <code>MessageSwitchPlayer</code></p>
<pre><code>// We always get a `data` so check if it has one key from our expected message
if (spawnInfo.data != null &amp;&amp; spawnInfo.data.ContainsKey(&quot;dir&quot;)) {
    // This player was transferred from another game.

    ...
} else {
    // It&#39;s a brand new player

}
</code></pre><p>In the case of it being a player transfered from another game
first it converts the data sent into a <code>MessageSwitchGame</code>.</p>
<pre><code>// Turn the data back into our structure
DeJson.Deserializer deserializer = new DeJson.Deserializer();
MessageSwitchGame data = deserializer.Deserialize&lt;MessageSwitchGame&gt;(spawnInfo.data);
</code></pre><p>Then it checks, if they were on the right on the
old game it spawns them on the left, if they were on the left it spawns them on the right,
at the same height as the exited the previous game.</p>
<pre><code>// Choose a starting position based on the old position
float x = (data.pos.x &lt; LevelSettings.settings.leftEdgeOfLevel.position.x)
    ? LevelSettings.settings.rightEdgeOfLevel.position.x - 1 :
      LevelSettings.settings.leftEdgeOfLevel.position.x + 1;
transform.localPosition = new Vector3(x, data.pos.y, 0f);
</code></pre><p>Finally it sets up the other state sent from the previous game</p>
<pre><code>// Set the initial velocity
m_rigidbody2d.velocity = data.vel;

// And the direction
m_direction = data.dir;

SetName(data.name);
SetColor(data.color);
</code></pre><p>All of this makes it appear that it&#39;s all one big game when in reality
it&#39;s multiple games running entirely independently.</p>
<h2 id="command-line-arguments">Command Line Arguments</h2>
<p>The <code>--hft-id</code>, <code>--hft-url</code> and <code>--hft-master</code> are all handled by HappyFunTimes for you.</p>
<ul>
<li><p><code>--hft-id</code></p>
<p>This specified the game id for that machine</p>
</li>
<li><p><code>--hft-url</code></p>
<p>This specifies the URL of the machine running HappyFunTimes. Only one machine should run HappyFunTimes.</p>
<p>If you&#39;re really setting up an installation you probably want to make sure your router always
gives the machine running HappyFunTimes the same IP addess. Consult your router&#39;s manual for
how to do this.</p>
</li>
<li><p><code>--hft-master</code></p>
<p>This tells HappyFunTimes which machine should receive new players. By default the first game
to connect to HappyFunTimes will receive the players unless you pass in <code>--hft-master</code>.</p>
<p>If you setup an installation with 10 machines and turn the power on you probably have no idea
which machine will boot fastest and connect to HappyFunTimes first so you need to tell HappyFunTimes
which machine should receive new players.</p>
<p>Of course if you&#39;d like them to be randomly assigned then setup some logic in your <code>InitializeNetPlayer</code>
function that if the player just connect randomly picks a game id and sends them to that game.</p>
</li>
</ul>
<h2 id="custom-command-line-arguments">Custom Command Line Arguments</h2>
<p>If you look in the sample above in <code>Assets/HappyFunTimes/Scripts/LevelSettings.cs</code> you can see
some code like this</p>
<pre><code>void Awake()
{
    ...
    ArgParser p = new ArgParser();
    p.TryGet&lt;int&gt;(&quot;num-games&quot;, ref numGames);
    ...
}
</code></pre><p>Feel free to change that script to meet your needs. If you&#39;d like to get command line arguments
somewhere else create an <code>ArgParser</code> and then use it to read any commmand line arguments you want. The sample
above uses &quot;--num-games&quot; to allow an infinite number of games. If you are designing
a specific game with a specific number of machines you probably wouldn&#39;t need a <code>numGames</code>
setting at all as you&#39;d probably hard code game ids for your specific setup.</p>
<p>On the other hand a common command line argument you might need would be which level to load or
which part of a larger level to view. If you had a 3d installation where each monitor was
like a portal into 3d space your arguments might be the position, target and field of view
for the camera, etc...</p>

      <hr/>
      <div>
        <div>Questions? <a href="http://stackoverflow.com/questions/tagged/happyfuntimes">Ask on stackoverflow</a>.</div>
        <div>Issue/Bug? <a href="http://github.com/greggman/happyfuntimes/issues">Create an issue on github</a>.</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'happyfuntimes'; // required: replace example with your forum shortname
            var disqus_identifier = 'Multiple Computers';
            var disqus_title = 'Multiple Computers';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("happyfuntimes") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
    <div class="col-sm-3 col-sm-offset-1 lesson-sidebar">
        <ul class="toc">
<li>HappyFunTimes & Unity
  <ul>
    <li><a href="getting-started.html">Getting Started</a><span class="hide">: Do this first!!</span></li>
    <li><a href="first-game.html">Your First HappyFunTimes Game</a><span class="hide">: Do this second!!</span></li>
    <li><a href="gamepad.html">The Sample Gamepad</a><span class="hide": Read this!!!</li>
    <li><a href="basics.html">How it Works</a><span class="hide">: Read this!!!</span></li>
  </ul>
</li>
<li>Specifics
  <ul>
    <li><a href="player-connect.html">Spawn players</a></li>
    <li><a href="self-control.html">Making controllers (the phone part)</a></li>
    <li><a href="gamepad-sounds.html">Playing sounds on the phone</a></li>
    <li><a href="gamepad-multitouch.html">Handling Multi-Touch</a></li>
  </ul>
</li>
<li>Examples
  <ul>
    <li><a href="3d-characters.html">3d Characters</a></li>
    <li><a href="2d-platformer.html">2d Platformer</a></li>

  </ul>
</li>
<li>Techinques
  <ul>
    <li><a href="reusing-players.html">Handling disconnect and reconnect</a></li>
    <li><a href="too-many-players.html">Preventing too many players</a></li>
    <li><a href="device-orientation.html">Using Device Orientation</a></li>
    <li><a href="accelerometer.html">Using the Accelerometer</a></li>
    <li><a href="character-selection.html">Spawning different characters per Player</a></li>
    <li><a href="multi-machine.html">Multiple Computers</a></li>
  </ul>
</li>
<li>API Reference
  <ul>
    <li><a href="/docs/hft/">Controller (HTML/JavaScript) API</a></li>
  </ul>
</li>
<li>Other
  <ul>
    <li><a href="changelog.html">Changelog</a></li>
  </ul>
</li>
</ul>




    </div>
  </div>
</div>
</body>
<script src="/docs/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/docs/3rdparty/prettify.js"></script>
<script src="/docs/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51764205-4', 'auto');
  ga('send', 'pageview');

</script>


</html>




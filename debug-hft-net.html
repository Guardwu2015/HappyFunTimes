<script>
function getJSON(url, obj, callback) {
  var xhr = new XMLHttpRequest();
  xhr.open('POST', url);
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.onload = function() {
    if (xhr.status === 200) {
      try {
        var obj = JSON.parse(xhr.responseText)
        callback(null, obj);
      } catch (e) {
        callback(e);
      }
    } else {
      callback("status not 200. Was " + xhr.status);
    }
  }
  xhr.onerror = function(e) {
    callback(e);
  };
  xhr.send(JSON.stringify(obj));
}

function log() {
  var elem = document.createElement("pre");
  elem.appendChild(document.createTextNode(Array.prototype.join.call(arguments, " ")));
  document.body.appendChild(elem);
}

function searchStringToObject(str, opt_obj) {
  if (str[0] === '?') {
    str = str.substring(1);
  }
  var results = opt_obj || {};
  str.split("&").forEach(function(part) {
    var pair = part.split("=").map(decodeURIComponent);
    results[pair[0]] = pair[1] !== undefined ? pair[1] : true;
  });
  return results;
}

/**
 * Reads the query values from a URL like string.
 * @param {String} url URL like string eg. http://foo?key=value
 * @param {Object} [opt_obj] Object to attach key values to
 * @return {Object} Object with key values from URL
 * @memberOf module:Misc
 */
var parseUrlQueryString = function(str, opt_obj) {
  var dst = opt_obj || {};
  try {
    var q = str.indexOf("?");
    var e = str.indexOf("#");
    if (e < 0) {
      e = str.length;
    }
    var query = str.substring(q + 1, e);
    searchStringToObject(query, dst);
  } catch (e) {
    console.error(e);
  }
  return dst;
};

/**
 * Reads the query values from the current URL.
 * @param {Object=} opt_obj Object to attach key values to
 * @return {Object} Object with key values from URL
 * @memberOf module:Misc
 */
var parseUrlQuery = function(opt_obj) {
  return searchStringToObject(window.location.search, opt_obj);
};

var q = parseUrlQuery();
var url = q.url || "http://happyfuntimes.net"

getJSON(url + "/api/getgames2", {}, function(err, obj) {
  if (err) {
    log("ERROR:", err);
  } else {
    log(JSON.stringify(obj, null, 2));
  }
});
</script>
